# 内存管理


## 虚拟内存
虚拟内存是磁盘的一部分，进程如果要访问的话就直接将该部分内存载入即可
>先说说为什么会有虚拟内存和物理内存的区别。正在运行的一个进程，他所需的内存是有可能大于内存条容量之和的，比如你的内存条是256M，你的程序却要创建一个2G的数据区，那么不是所有数据都能一起加载到内存（物理内存）中，势必有一部分数据要放到其他介质中（比如硬盘），待进程需要访问那部分数据时，在通过调度进入物理内存。所以，虚拟内存是进程运行时所有内存空间的总和，并且可能有一部分不在物理内存中，而物理内存就是我们平时所了解的内存条。有的地方呢，也叫这个虚拟内存为内存交换区。

一个进程只能在内存中执行，因此这个存储器称为实存储器，简称实存。但是程序员或用户感觉到的是一个更大的内存，通常它被分配在磁盘上，称为虚拟内存，简称虚存


**虚拟内存，物理内存**

1. 虚拟内存的空间要比物理内存大，所以只能讲虚拟内存的部分放到物理内存

2. 物理内存就成为了虚拟内存的缓存系统了

3. 说白了就这两者的关系就好像是redis当做缓存层，持久层是数据库，存储了应用的所有数据


1.主要有两个点

- 虚拟内存使得程序不必完全载入内存才可以才能运行

- 不必将程序完全载入即可运行使得程序可以比实际内存更大

- 程序需要的部分放入内存，用不到的几乎从来不进入内存，内存利用率高。

**虚拟地址空间是不等于虚拟内存的**

虚拟地址空间，代表进程的虚拟地址空间，

1. 页号
2. 页内偏移


**虚拟内存是要比物理内存**

**页表**

页表的每一个表项分为两部分

1. 第一部分记录此页是否在物理内存中，有效位，只有0和1两种可能性
2. 第二部分记录物理内存页的地址（如果在的话）

1. 为何要虚拟内存技术
> 使得程序的内存



## 内存管理技术

### 页式存储管理

**页式存储管理**

将虚拟内存和物理内存都平均划分为一页，每一个页大小是固定的，进程的数据分别就从存储在不同的页当中

虚拟内存当中的页页被分为三种情况，虚拟内存的虚拟页在任何时刻都分为三个不相交的子集

- 未分配的，VM系统未分配的(或创建的)，未分配的页没有任何程序的数据与他们关联，所以也就没有

- 已分配的但是没有缓存的，分配了数据，但是在物理内存当中还没有映射，如果CPU要访问这块页的话就会产生缺页

- 已经缓存的，有程序数据关联了，并且虚拟缓存的页被映射到了物理内存里面了，如果cpu访问这块虚拟内存页，就会命中

### 页式存储管理优势

1. 解决外部碎片的问题，消除了外部碎片，可高效的使用内存。

2. 一个程序不必连续存放。

3. 相邻的虚拟页在物理页当中不一定连续，相邻的页面在内存中不一定相邻，即分配给程序的内存块之间不一定连续。



### 缺点

远离程序员，不符合程序员的思考习惯。


### 缺页操作

**问题**

当进程访问某个虚拟地址，去看页表，如果发现对应的页不在物理内存中，则缺页异常

**处理**



## 段式内存管理

[操作系统核心原理-5.内存管理（下）：段式内存管理](https://www.cnblogs.com/edisonchou/p/5115242.html)


**什么叫做段式内存管理？** 

将程序进行分段，装入内存。在段氏存储管理系统中，为每个段分配一个连续的分区，而进程当中的各个段可以不连续得放在

![](https://github.com/wabc1994/InterviewRecord/blob/master/OS/pic/%E6%AE%B5%E5%BC%8F%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86.png)

### 优点

分页对程序员而言是不可见的，而分段通常对程序员而言是可见的，因而分段为组织程序和数据提供了方便。


# 参考链接

[内存管理（中）：分页内存管理](https://www.cnblogs.com/edisonchou/p/5094066.html)

