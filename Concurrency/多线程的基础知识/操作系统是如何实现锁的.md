# 操作系统是如何实现锁的？

Java当中的锁最终都是通过虚拟机操作系统底层来实现，调用pthread_mutex_lock 和 pthread_mutex_unlock。

就比如在AQS当中维护了一个state状态变量，这个变量state就代表锁，锁的实质其实就是一个变量

**实质**

所谓的锁，说白了就是内存中的一个整型数，拥有两种状态：空闲状态和上锁状态。加锁时，判断锁是否空闲，如果空闲，修改为上锁状态，返回成功；如果已经上锁，则返回失败。解锁时，则把锁状态修改为空闲状态。

在硬件层面，CPU提供了**原子操作**、**关中断**、**锁内存总线**、**内存屏障**的机制；OS基于这几个CPU硬件机制，就能够实现锁；