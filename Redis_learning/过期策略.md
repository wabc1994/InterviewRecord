# 背景

为何要设置过期时间？redis作为缓存，很多数据如果都是临时存储以下而已，可能用过之后很久就不会再用到，就要从缓存中删除出去？

Redis 是否用到家，从这就能看出来。比如你 Redis 只能存 5G 数据，可是你写了 10G，那会删 5G 的数据。怎么删的，这个问题思考过么?

redis采取的策略:两个操作叠加的方式解决这个问题，配合使用，要不然单独使用是出现问题的？

**过期策略针对的过期key,与内存淘汰策略要区分开来**


**过期策略和**

## 设置过期健的命令
- expire key time
 
## redis的过期淘汰策略 

> 定期删除+惰性删除策略

## 为何不用定时删除？

含义： 在设置key的过期时间的同时，为该key创建一个定时器(为每一个key设置一个定时器)，让定时器在key的过期时间来临时，对key进行删除

优点：保证内存被尽快释放

缺点：

- 定时删除，用一个定时器来监视key,过期则自动删除。虽然内存及时释放，但是十分消耗CPU资源。
    
- 若过期key很多，删除这些key会占用很多的CPU时间，在CPU时间紧张的情况下，CPU不能把所有的时间用来做要紧的事儿，还需要去花时间删除这些key

- 定时器的创建耗时，若为每一个设置过期时间的key创建一个定时器（将会有大量的定时器产生），性能影响严重

**在大并发请求下，CPU要将时间应用在处理请求，而不是删除 Key，因此没有采用这一策略。**

## 单独定期删除

定期删除，Redis 默认每个 100ms 检查，有过期 Key 则删除。需要说明的是，Redis 不是每个 100ms 将所有的 Key 检查一次，而是随机抽取进行检查。

优点： 
- 通过限制删除操作的时长和频率，来减少删除操作对CPU时间的占用--处理"定时删除"的缺点

- 
存在的问题
>由于是采取的定期随机选取一部分过期key，有可能导致很多key 到时间还没有被删除



## 惰性删除

- key过期的时候不删除，每次从数据库获取key的时候去检查是否过期，若过期，则删除，返回null。

- 优点： 删除删除操作只发生在从数据库取出key的时候发生，而且只删除当前key，所以对CPU时间的占用是比较少的，而且此时的删除是已经到了非做不可的地步（如果此时还不删除的话，我们就会获取到了已经过期的key了）

- 缺点： 若大量的key在超出超时时间后，很久一段时间内，都没有被获取过，那么可能发生内存泄露（无用的垃圾占用了大量的内存）


## 采用定期删除+惰性删除就没有其他问题了吗？

如果上述两种方式还是没有效果的话？都失效

不是的，如果定期没删除掉key.并且你也没有及时去请求key, 也就是惰性删除也没有效。这样redis的内存只会越来越高。

那在这样的情况下，就应该采取内存淘汰策略机制。

[](https://github.com/wabc1994/InterviewRecord/blob/master/Redis_learning/内存淘汰策略.md)
