#  Redis 在项目当中的实战

主要是在项目当中作为缓存使用，首先理解缓存要理解下面几个点

1. Redis只是缓存， 不是数据库mysql， 所以redis当中有的数据， mysql当中也必然有
2. 用户先去请求Redis， 如果没有， 再去数据库当中去读取
3. Redis 中缓存只是缓存一些请求量比较打的数据， 这些数据，MySQL 当中也一定有得到， 



# 为何要使用Redis当做缓存

1. 加快访问速度

2. redis  是键值数据库， 缓存的数据都放在内存当中， 读取速度比较快， 不像MySQL 这样的是存在磁盘当中的，数据要经过I/O 操作从磁盘（这里面就涉及到磁盘寻址等问题）加载到内存当中来， 这是非常耗时和低效的

3. 提高并发性。  

   常规的数据库Oracle 是如何处理大量并发请求的， 

   1. 通常MYSQL这样的数据库都是设置了最大连接数目的(通常是100)， 也就是最大并发数目， 超过了最大连接数目的话， 那么久采用先来先服务的策略
   2. 关于MySQL是如何解决并发控制? **锁(各种各样的锁，乐观锁和悲观锁) 事务，隔离，也就是我们经常在面经当中见到的考题 ，这些都是关于MySQL 如何来处理并发的**?

## 作为缓存使用的话？

难点

1. 如何保证数据之间的再数据库和缓存之间的一直性问题

2. 如何保证缓存的有效性问题（如何保证里面的数据都是热点key， 也就是**Redis的key过期策略**）

3. 如何防止缓存雪崩

     - 什么叫雪崩？在同一个时刻如果我们将chace当中的过期时间设置为一样的话，同时失效， 导致在某一个时刻所有的请求都转发到数据库层面， 数据库瞬间压力过大导致雪崩。





     如何保证缓存穿透等问题  (查询一个不存在的key, 反正这个key肯定不存在， 如果攻击者伪造大量的不存在的可以进行访问(大量的高并发无效访问)，在缓存中找不到， 在数据库当中也肯定是找不到的，会造成恶意破坏)



**缓存雪崩和缓存击穿的区别： 雪崩是针对大量不同的key, 同一个可以 ,有时候这两种问题是放在一起考虑和解决的**

## 关于缓存这块的问题

参考链接

[链接一：缓存穿透和缓存雪崩的预防和解决-Redis](https://blog.csdn.net/qq496013218/article/details/78502423)

[链接二：Redis在项目中的应用总结](https://blog.csdn.net/wang258533488/article/details/78901124)

# 如何解决Redis作为缓存访问的问题？

这个问题也可以衍生为如何设计一个缓存系统？

设计一个缓存系统要考虑的问题。

1. Cache  穿透
   - 布隆过滤器
   - 另外一种简单
2. 雪崩
   - 如何防止缓存集体失效，这个是核心问题？ 简单的做法， 在设置了了相同的过期时间话，我们可以在过期时间的基础上增加一个随机数， 比如1-10分钟， 或者秒， 这样就避免了在同一时刻缓存集体失效的问题
   - 使用加锁或者队列

关于如何解决这块问题， 链接二当中的作者在他的项目当中有一个图 ， 总计了整个流程是如何解决这个问题的？

可以使用这个流程来解决这个问题

![](https://github.com/wabc1994/InterviewRecord/blob/master/Redis_learning/picture/solution.png)

# MySQL 和redis数据一致性处理

比如订单查询， 我们可以说在项目当中是先更新数据库，数据库更新成功了 ，然后再去更新缓存， 如果DB 更新成功了， 而缓存操作失败了， 这样就出现了数据不一致性问题，如何保证数据的一致性问题





# 为何使用mongodb

Mongodb是介于关系型数据库和非关系数据之间的关系的, 主要是考虑到mongodb可以存储二进制文件， 而传统的MySQL 存储图片的话，主要还是存储图片在服务器当中的存放路径

在项目主要使用mongodb 来存储图片的基本情况,

首先要决定图片大小是否存储mongodb 本地的数据库， 还是GridFS 

存储的数据类似于json格式， 基于分布式文件存储的开源数据库系统



MongoDB 的主要特性有一下几个方面

1. 不支持事务

2. 支持索引
3. 使用存储一些数据量比较大，然后数据之间的关系又比较简单的， 比如我们平台虚拟机上面的监控信息， 包括内存，IO等主要的运维工作可以使用下吧

不适用的场景

1. 需要SQL的问题。

2. 高度事物性的系统：例如银行或会计系统。传统的关系型数据库目前还是更适用于需要大量原子性复杂事务的应用程序。

3.传统的商业智能应用：针对特定问题的BI数据库会对产生高度优化的查询方式。对于此类应用，数据仓库可能是更合适的选择。

 ## 如何使用spring来管理Redis

## 使用的基本流程

1. 定义连接池JedisPool， 获取一个连接Jedis 对象
2. 或者定义一个配置类RedisConfig
3. 业务逻辑处理模块Service 