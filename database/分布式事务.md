# 什么是分布式事务？

## 概念

之前所所学的数据库系统与设计中的内容都是基于单数据库的本地事物，比如数据库中的事务，并发操作， 隔离级别等情况都是单库事务，并不支持跨库事务。而随着微服务等架构的普及，一个大型业务系统往往由**若干个子系统**组成，这些子系统都有自己独立数据库。往往一个业务流程需要多个子系统共同完成，而这些操作需要在一个事务中完成。在微服务系统中，这些业务场景是普遍存在的。此时，我们就需要在数据库之上通过某种手段，实现支持跨数据库的事务支持，这也就是大家常说的“分布式事务”。

## 案列

这里举一个分布式事务的典型例子——用户下单过程。 当我们的系统采用了微服务架构后，一个电商系统往往被拆分成如下几个子系统：商品系统、订单系统、支付系统、积分系统等。整个下单的过程如下：

1. 用户通过商品系统浏览商品，他看中了某一项商品，便点击下单
2. 此时订单系统会生成一条订单
3. 订单创建成功后，支付系统提供支付功能
4. 当支付完成后，由积分系统为该用户增加积分

上述步骤2、3、4需要在一个事务中完成。对于传统单体应用而言，实现事务非常简单，只需将这三个步骤放在一个方法A中，再用Spring的@Transactional注解标识该方法即可。Spring通过数据库的事务支持，保证这些步骤要么全都执行完成，要么全都不执行。但在这个微服务架构中，这三个步骤涉及三个系统，涉及三个数据库，此时我们必须在数据库和应用系统之间，通过某项黑科技，实现分布式事务的支持。

# 如何解决分布式事务的一致性问题

## - CAP理论

## - BASE理论

## - 分布式事务协议

# 分布式事务的协议

分布式系统的一个难点是如何保证架构下多个节点在进行事务性操作的时候保持一致性。

为了实现上述的目标就有了下面几个理论

## 两阶段提交协议2pc

## 三阶段提交协议3pc

## paxos协议

---
上面是理论部分情况， 然后主要是是in action zookeeper 部分情况

# zookeeper 

[参考链接](https://github.com/wabc1994/Leetcode2/tree/master/zookeeper)

上面三个协议如何做，具体去查看 《从paxos 到zookeeper》这本书即可，具体如何实现的情况 

